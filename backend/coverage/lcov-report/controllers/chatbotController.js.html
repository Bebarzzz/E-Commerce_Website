
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for controllers/chatbotController.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../index.html">All files</a> / <a href="index.html">controllers</a> chatbotController.js</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/131</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/107</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/28</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/122</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a>
<a name='L4'></a><a href='#L4'>4</a>
<a name='L5'></a><a href='#L5'>5</a>
<a name='L6'></a><a href='#L6'>6</a>
<a name='L7'></a><a href='#L7'>7</a>
<a name='L8'></a><a href='#L8'>8</a>
<a name='L9'></a><a href='#L9'>9</a>
<a name='L10'></a><a href='#L10'>10</a>
<a name='L11'></a><a href='#L11'>11</a>
<a name='L12'></a><a href='#L12'>12</a>
<a name='L13'></a><a href='#L13'>13</a>
<a name='L14'></a><a href='#L14'>14</a>
<a name='L15'></a><a href='#L15'>15</a>
<a name='L16'></a><a href='#L16'>16</a>
<a name='L17'></a><a href='#L17'>17</a>
<a name='L18'></a><a href='#L18'>18</a>
<a name='L19'></a><a href='#L19'>19</a>
<a name='L20'></a><a href='#L20'>20</a>
<a name='L21'></a><a href='#L21'>21</a>
<a name='L22'></a><a href='#L22'>22</a>
<a name='L23'></a><a href='#L23'>23</a>
<a name='L24'></a><a href='#L24'>24</a>
<a name='L25'></a><a href='#L25'>25</a>
<a name='L26'></a><a href='#L26'>26</a>
<a name='L27'></a><a href='#L27'>27</a>
<a name='L28'></a><a href='#L28'>28</a>
<a name='L29'></a><a href='#L29'>29</a>
<a name='L30'></a><a href='#L30'>30</a>
<a name='L31'></a><a href='#L31'>31</a>
<a name='L32'></a><a href='#L32'>32</a>
<a name='L33'></a><a href='#L33'>33</a>
<a name='L34'></a><a href='#L34'>34</a>
<a name='L35'></a><a href='#L35'>35</a>
<a name='L36'></a><a href='#L36'>36</a>
<a name='L37'></a><a href='#L37'>37</a>
<a name='L38'></a><a href='#L38'>38</a>
<a name='L39'></a><a href='#L39'>39</a>
<a name='L40'></a><a href='#L40'>40</a>
<a name='L41'></a><a href='#L41'>41</a>
<a name='L42'></a><a href='#L42'>42</a>
<a name='L43'></a><a href='#L43'>43</a>
<a name='L44'></a><a href='#L44'>44</a>
<a name='L45'></a><a href='#L45'>45</a>
<a name='L46'></a><a href='#L46'>46</a>
<a name='L47'></a><a href='#L47'>47</a>
<a name='L48'></a><a href='#L48'>48</a>
<a name='L49'></a><a href='#L49'>49</a>
<a name='L50'></a><a href='#L50'>50</a>
<a name='L51'></a><a href='#L51'>51</a>
<a name='L52'></a><a href='#L52'>52</a>
<a name='L53'></a><a href='#L53'>53</a>
<a name='L54'></a><a href='#L54'>54</a>
<a name='L55'></a><a href='#L55'>55</a>
<a name='L56'></a><a href='#L56'>56</a>
<a name='L57'></a><a href='#L57'>57</a>
<a name='L58'></a><a href='#L58'>58</a>
<a name='L59'></a><a href='#L59'>59</a>
<a name='L60'></a><a href='#L60'>60</a>
<a name='L61'></a><a href='#L61'>61</a>
<a name='L62'></a><a href='#L62'>62</a>
<a name='L63'></a><a href='#L63'>63</a>
<a name='L64'></a><a href='#L64'>64</a>
<a name='L65'></a><a href='#L65'>65</a>
<a name='L66'></a><a href='#L66'>66</a>
<a name='L67'></a><a href='#L67'>67</a>
<a name='L68'></a><a href='#L68'>68</a>
<a name='L69'></a><a href='#L69'>69</a>
<a name='L70'></a><a href='#L70'>70</a>
<a name='L71'></a><a href='#L71'>71</a>
<a name='L72'></a><a href='#L72'>72</a>
<a name='L73'></a><a href='#L73'>73</a>
<a name='L74'></a><a href='#L74'>74</a>
<a name='L75'></a><a href='#L75'>75</a>
<a name='L76'></a><a href='#L76'>76</a>
<a name='L77'></a><a href='#L77'>77</a>
<a name='L78'></a><a href='#L78'>78</a>
<a name='L79'></a><a href='#L79'>79</a>
<a name='L80'></a><a href='#L80'>80</a>
<a name='L81'></a><a href='#L81'>81</a>
<a name='L82'></a><a href='#L82'>82</a>
<a name='L83'></a><a href='#L83'>83</a>
<a name='L84'></a><a href='#L84'>84</a>
<a name='L85'></a><a href='#L85'>85</a>
<a name='L86'></a><a href='#L86'>86</a>
<a name='L87'></a><a href='#L87'>87</a>
<a name='L88'></a><a href='#L88'>88</a>
<a name='L89'></a><a href='#L89'>89</a>
<a name='L90'></a><a href='#L90'>90</a>
<a name='L91'></a><a href='#L91'>91</a>
<a name='L92'></a><a href='#L92'>92</a>
<a name='L93'></a><a href='#L93'>93</a>
<a name='L94'></a><a href='#L94'>94</a>
<a name='L95'></a><a href='#L95'>95</a>
<a name='L96'></a><a href='#L96'>96</a>
<a name='L97'></a><a href='#L97'>97</a>
<a name='L98'></a><a href='#L98'>98</a>
<a name='L99'></a><a href='#L99'>99</a>
<a name='L100'></a><a href='#L100'>100</a>
<a name='L101'></a><a href='#L101'>101</a>
<a name='L102'></a><a href='#L102'>102</a>
<a name='L103'></a><a href='#L103'>103</a>
<a name='L104'></a><a href='#L104'>104</a>
<a name='L105'></a><a href='#L105'>105</a>
<a name='L106'></a><a href='#L106'>106</a>
<a name='L107'></a><a href='#L107'>107</a>
<a name='L108'></a><a href='#L108'>108</a>
<a name='L109'></a><a href='#L109'>109</a>
<a name='L110'></a><a href='#L110'>110</a>
<a name='L111'></a><a href='#L111'>111</a>
<a name='L112'></a><a href='#L112'>112</a>
<a name='L113'></a><a href='#L113'>113</a>
<a name='L114'></a><a href='#L114'>114</a>
<a name='L115'></a><a href='#L115'>115</a>
<a name='L116'></a><a href='#L116'>116</a>
<a name='L117'></a><a href='#L117'>117</a>
<a name='L118'></a><a href='#L118'>118</a>
<a name='L119'></a><a href='#L119'>119</a>
<a name='L120'></a><a href='#L120'>120</a>
<a name='L121'></a><a href='#L121'>121</a>
<a name='L122'></a><a href='#L122'>122</a>
<a name='L123'></a><a href='#L123'>123</a>
<a name='L124'></a><a href='#L124'>124</a>
<a name='L125'></a><a href='#L125'>125</a>
<a name='L126'></a><a href='#L126'>126</a>
<a name='L127'></a><a href='#L127'>127</a>
<a name='L128'></a><a href='#L128'>128</a>
<a name='L129'></a><a href='#L129'>129</a>
<a name='L130'></a><a href='#L130'>130</a>
<a name='L131'></a><a href='#L131'>131</a>
<a name='L132'></a><a href='#L132'>132</a>
<a name='L133'></a><a href='#L133'>133</a>
<a name='L134'></a><a href='#L134'>134</a>
<a name='L135'></a><a href='#L135'>135</a>
<a name='L136'></a><a href='#L136'>136</a>
<a name='L137'></a><a href='#L137'>137</a>
<a name='L138'></a><a href='#L138'>138</a>
<a name='L139'></a><a href='#L139'>139</a>
<a name='L140'></a><a href='#L140'>140</a>
<a name='L141'></a><a href='#L141'>141</a>
<a name='L142'></a><a href='#L142'>142</a>
<a name='L143'></a><a href='#L143'>143</a>
<a name='L144'></a><a href='#L144'>144</a>
<a name='L145'></a><a href='#L145'>145</a>
<a name='L146'></a><a href='#L146'>146</a>
<a name='L147'></a><a href='#L147'>147</a>
<a name='L148'></a><a href='#L148'>148</a>
<a name='L149'></a><a href='#L149'>149</a>
<a name='L150'></a><a href='#L150'>150</a>
<a name='L151'></a><a href='#L151'>151</a>
<a name='L152'></a><a href='#L152'>152</a>
<a name='L153'></a><a href='#L153'>153</a>
<a name='L154'></a><a href='#L154'>154</a>
<a name='L155'></a><a href='#L155'>155</a>
<a name='L156'></a><a href='#L156'>156</a>
<a name='L157'></a><a href='#L157'>157</a>
<a name='L158'></a><a href='#L158'>158</a>
<a name='L159'></a><a href='#L159'>159</a>
<a name='L160'></a><a href='#L160'>160</a>
<a name='L161'></a><a href='#L161'>161</a>
<a name='L162'></a><a href='#L162'>162</a>
<a name='L163'></a><a href='#L163'>163</a>
<a name='L164'></a><a href='#L164'>164</a>
<a name='L165'></a><a href='#L165'>165</a>
<a name='L166'></a><a href='#L166'>166</a>
<a name='L167'></a><a href='#L167'>167</a>
<a name='L168'></a><a href='#L168'>168</a>
<a name='L169'></a><a href='#L169'>169</a>
<a name='L170'></a><a href='#L170'>170</a>
<a name='L171'></a><a href='#L171'>171</a>
<a name='L172'></a><a href='#L172'>172</a>
<a name='L173'></a><a href='#L173'>173</a>
<a name='L174'></a><a href='#L174'>174</a>
<a name='L175'></a><a href='#L175'>175</a>
<a name='L176'></a><a href='#L176'>176</a>
<a name='L177'></a><a href='#L177'>177</a>
<a name='L178'></a><a href='#L178'>178</a>
<a name='L179'></a><a href='#L179'>179</a>
<a name='L180'></a><a href='#L180'>180</a>
<a name='L181'></a><a href='#L181'>181</a>
<a name='L182'></a><a href='#L182'>182</a>
<a name='L183'></a><a href='#L183'>183</a>
<a name='L184'></a><a href='#L184'>184</a>
<a name='L185'></a><a href='#L185'>185</a>
<a name='L186'></a><a href='#L186'>186</a>
<a name='L187'></a><a href='#L187'>187</a>
<a name='L188'></a><a href='#L188'>188</a>
<a name='L189'></a><a href='#L189'>189</a>
<a name='L190'></a><a href='#L190'>190</a>
<a name='L191'></a><a href='#L191'>191</a>
<a name='L192'></a><a href='#L192'>192</a>
<a name='L193'></a><a href='#L193'>193</a>
<a name='L194'></a><a href='#L194'>194</a>
<a name='L195'></a><a href='#L195'>195</a>
<a name='L196'></a><a href='#L196'>196</a>
<a name='L197'></a><a href='#L197'>197</a>
<a name='L198'></a><a href='#L198'>198</a>
<a name='L199'></a><a href='#L199'>199</a>
<a name='L200'></a><a href='#L200'>200</a>
<a name='L201'></a><a href='#L201'>201</a>
<a name='L202'></a><a href='#L202'>202</a>
<a name='L203'></a><a href='#L203'>203</a>
<a name='L204'></a><a href='#L204'>204</a>
<a name='L205'></a><a href='#L205'>205</a>
<a name='L206'></a><a href='#L206'>206</a>
<a name='L207'></a><a href='#L207'>207</a>
<a name='L208'></a><a href='#L208'>208</a>
<a name='L209'></a><a href='#L209'>209</a>
<a name='L210'></a><a href='#L210'>210</a>
<a name='L211'></a><a href='#L211'>211</a>
<a name='L212'></a><a href='#L212'>212</a>
<a name='L213'></a><a href='#L213'>213</a>
<a name='L214'></a><a href='#L214'>214</a>
<a name='L215'></a><a href='#L215'>215</a>
<a name='L216'></a><a href='#L216'>216</a>
<a name='L217'></a><a href='#L217'>217</a>
<a name='L218'></a><a href='#L218'>218</a>
<a name='L219'></a><a href='#L219'>219</a>
<a name='L220'></a><a href='#L220'>220</a>
<a name='L221'></a><a href='#L221'>221</a>
<a name='L222'></a><a href='#L222'>222</a>
<a name='L223'></a><a href='#L223'>223</a>
<a name='L224'></a><a href='#L224'>224</a>
<a name='L225'></a><a href='#L225'>225</a>
<a name='L226'></a><a href='#L226'>226</a>
<a name='L227'></a><a href='#L227'>227</a>
<a name='L228'></a><a href='#L228'>228</a>
<a name='L229'></a><a href='#L229'>229</a>
<a name='L230'></a><a href='#L230'>230</a>
<a name='L231'></a><a href='#L231'>231</a>
<a name='L232'></a><a href='#L232'>232</a>
<a name='L233'></a><a href='#L233'>233</a>
<a name='L234'></a><a href='#L234'>234</a>
<a name='L235'></a><a href='#L235'>235</a>
<a name='L236'></a><a href='#L236'>236</a>
<a name='L237'></a><a href='#L237'>237</a>
<a name='L238'></a><a href='#L238'>238</a>
<a name='L239'></a><a href='#L239'>239</a>
<a name='L240'></a><a href='#L240'>240</a>
<a name='L241'></a><a href='#L241'>241</a>
<a name='L242'></a><a href='#L242'>242</a>
<a name='L243'></a><a href='#L243'>243</a>
<a name='L244'></a><a href='#L244'>244</a>
<a name='L245'></a><a href='#L245'>245</a>
<a name='L246'></a><a href='#L246'>246</a>
<a name='L247'></a><a href='#L247'>247</a>
<a name='L248'></a><a href='#L248'>248</a>
<a name='L249'></a><a href='#L249'>249</a>
<a name='L250'></a><a href='#L250'>250</a>
<a name='L251'></a><a href='#L251'>251</a>
<a name='L252'></a><a href='#L252'>252</a>
<a name='L253'></a><a href='#L253'>253</a>
<a name='L254'></a><a href='#L254'>254</a>
<a name='L255'></a><a href='#L255'>255</a>
<a name='L256'></a><a href='#L256'>256</a>
<a name='L257'></a><a href='#L257'>257</a>
<a name='L258'></a><a href='#L258'>258</a>
<a name='L259'></a><a href='#L259'>259</a>
<a name='L260'></a><a href='#L260'>260</a>
<a name='L261'></a><a href='#L261'>261</a>
<a name='L262'></a><a href='#L262'>262</a>
<a name='L263'></a><a href='#L263'>263</a>
<a name='L264'></a><a href='#L264'>264</a>
<a name='L265'></a><a href='#L265'>265</a>
<a name='L266'></a><a href='#L266'>266</a>
<a name='L267'></a><a href='#L267'>267</a>
<a name='L268'></a><a href='#L268'>268</a>
<a name='L269'></a><a href='#L269'>269</a>
<a name='L270'></a><a href='#L270'>270</a>
<a name='L271'></a><a href='#L271'>271</a>
<a name='L272'></a><a href='#L272'>272</a>
<a name='L273'></a><a href='#L273'>273</a>
<a name='L274'></a><a href='#L274'>274</a>
<a name='L275'></a><a href='#L275'>275</a>
<a name='L276'></a><a href='#L276'>276</a>
<a name='L277'></a><a href='#L277'>277</a>
<a name='L278'></a><a href='#L278'>278</a>
<a name='L279'></a><a href='#L279'>279</a>
<a name='L280'></a><a href='#L280'>280</a>
<a name='L281'></a><a href='#L281'>281</a>
<a name='L282'></a><a href='#L282'>282</a>
<a name='L283'></a><a href='#L283'>283</a>
<a name='L284'></a><a href='#L284'>284</a>
<a name='L285'></a><a href='#L285'>285</a>
<a name='L286'></a><a href='#L286'>286</a>
<a name='L287'></a><a href='#L287'>287</a>
<a name='L288'></a><a href='#L288'>288</a>
<a name='L289'></a><a href='#L289'>289</a>
<a name='L290'></a><a href='#L290'>290</a>
<a name='L291'></a><a href='#L291'>291</a>
<a name='L292'></a><a href='#L292'>292</a>
<a name='L293'></a><a href='#L293'>293</a>
<a name='L294'></a><a href='#L294'>294</a>
<a name='L295'></a><a href='#L295'>295</a>
<a name='L296'></a><a href='#L296'>296</a>
<a name='L297'></a><a href='#L297'>297</a>
<a name='L298'></a><a href='#L298'>298</a>
<a name='L299'></a><a href='#L299'>299</a>
<a name='L300'></a><a href='#L300'>300</a>
<a name='L301'></a><a href='#L301'>301</a>
<a name='L302'></a><a href='#L302'>302</a>
<a name='L303'></a><a href='#L303'>303</a>
<a name='L304'></a><a href='#L304'>304</a>
<a name='L305'></a><a href='#L305'>305</a>
<a name='L306'></a><a href='#L306'>306</a>
<a name='L307'></a><a href='#L307'>307</a>
<a name='L308'></a><a href='#L308'>308</a>
<a name='L309'></a><a href='#L309'>309</a>
<a name='L310'></a><a href='#L310'>310</a>
<a name='L311'></a><a href='#L311'>311</a>
<a name='L312'></a><a href='#L312'>312</a>
<a name='L313'></a><a href='#L313'>313</a>
<a name='L314'></a><a href='#L314'>314</a>
<a name='L315'></a><a href='#L315'>315</a>
<a name='L316'></a><a href='#L316'>316</a>
<a name='L317'></a><a href='#L317'>317</a>
<a name='L318'></a><a href='#L318'>318</a>
<a name='L319'></a><a href='#L319'>319</a>
<a name='L320'></a><a href='#L320'>320</a>
<a name='L321'></a><a href='#L321'>321</a>
<a name='L322'></a><a href='#L322'>322</a>
<a name='L323'></a><a href='#L323'>323</a>
<a name='L324'></a><a href='#L324'>324</a>
<a name='L325'></a><a href='#L325'>325</a>
<a name='L326'></a><a href='#L326'>326</a>
<a name='L327'></a><a href='#L327'>327</a>
<a name='L328'></a><a href='#L328'>328</a>
<a name='L329'></a><a href='#L329'>329</a>
<a name='L330'></a><a href='#L330'>330</a>
<a name='L331'></a><a href='#L331'>331</a>
<a name='L332'></a><a href='#L332'>332</a>
<a name='L333'></a><a href='#L333'>333</a>
<a name='L334'></a><a href='#L334'>334</a>
<a name='L335'></a><a href='#L335'>335</a>
<a name='L336'></a><a href='#L336'>336</a>
<a name='L337'></a><a href='#L337'>337</a>
<a name='L338'></a><a href='#L338'>338</a>
<a name='L339'></a><a href='#L339'>339</a>
<a name='L340'></a><a href='#L340'>340</a>
<a name='L341'></a><a href='#L341'>341</a>
<a name='L342'></a><a href='#L342'>342</a>
<a name='L343'></a><a href='#L343'>343</a>
<a name='L344'></a><a href='#L344'>344</a>
<a name='L345'></a><a href='#L345'>345</a>
<a name='L346'></a><a href='#L346'>346</a>
<a name='L347'></a><a href='#L347'>347</a>
<a name='L348'></a><a href='#L348'>348</a>
<a name='L349'></a><a href='#L349'>349</a>
<a name='L350'></a><a href='#L350'>350</a>
<a name='L351'></a><a href='#L351'>351</a>
<a name='L352'></a><a href='#L352'>352</a>
<a name='L353'></a><a href='#L353'>353</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">const Car = <span class="cstat-no" title="statement not covered" >require('../Models/carModel');</span>
&nbsp;
// Static car dataset for when database is not available
const staticCarsData = <span class="cstat-no" title="statement not covered" >[</span>
  {
    _id: '1',
    brand: 'MG',
    model: 'MG6',
    year: 2023,
    price: 22000,
    category: 'Sedan',
    transmission: 'CVT',
    fuelType: 'Gasoline',
    seats: 5,
    color: 'Various',
    status: 'available',
  }
];
&nbsp;
// Function to get available cars (from database or static data)
const getAvailableCarsData = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >as</span>ync () =&gt; {</span>
<span class="cstat-no" title="statement not covered" >  try {</span>
    const cars = <span class="cstat-no" title="statement not covered" >await Car.find({ status: 'available' })</span>
      .select('brand model year price category transmission fuelType seats color images')
      .limit(50);
<span class="cstat-no" title="statement not covered" >    return cars.length &gt; 0 ? cars : staticCarsData;</span>
  } catch (error) {
<span class="cstat-no" title="statement not covered" >    console.log('Database not available, using static car data');</span>
<span class="cstat-no" title="statement not covered" >    return staticCarsData;</span>
  }
};
&nbsp;
// Function to detect if query needs web search
const needsWebSearch = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(m</span>essage) =&gt; {</span>
  const lowerMessage = <span class="cstat-no" title="statement not covered" >message.toLowerCase();</span>
  
  // Keywords that indicate general car inquiries requiring web search
  const searchKeywords = <span class="cstat-no" title="statement not covered" >[</span>
    'what is', 'how to', 'latest', 'news', 'review', 'comparison', 'best', 
    'vs', 'versus', 'specs', 'specifications', 'features', 'history',
    'evolution', 'future', 'upcoming', 'recall', 'safety rating',
    'fuel efficiency', 'maintenance', 'tips', 'guide', 'tutorial',
    'problems', 'issues', 'common', 'famous', 'popular', 'trending'
  ];
  
  // Car-related terms
  const carTerms = <span class="cstat-no" title="statement not covered" >[</span>
    'car', 'cars', 'vehicle', 'automobile', 'auto', 'sedan', 'suv', 'truck',
    'hatchback', 'coupe', 'convertible', 'wagon', 'minivan', 'pickup',
    'motorcycle', 'bike', 'electric', 'hybrid', 'gasoline', 'diesel',
    'engine', 'transmission', 'tires', 'brakes', 'battery', 'charging'
  ];
  
  const hasSearchKeyword = <span class="cstat-no" title="statement not covered" >searchKeywords.some(<span class="fstat-no" title="function not covered" >ke</span>yword =&gt; <span class="cstat-no" title="statement not covered" >lowerMessage.includes(keyword))</span>;</span>
  const hasCarTerm = <span class="cstat-no" title="statement not covered" >carTerms.some(<span class="fstat-no" title="function not covered" >te</span>rm =&gt; <span class="cstat-no" title="statement not covered" >lowerMessage.includes(term))</span>;</span>
  
  // Don't search if asking about available cars or pricing from inventory
  const inventoryKeywords = <span class="cstat-no" title="statement not covered" >['available', 'price', 'cost', 'buy', 'purchase', 'inventory', 'stock'];</span>
  const isInventoryQuery = <span class="cstat-no" title="statement not covered" >inventoryKeywords.some(<span class="fstat-no" title="function not covered" >ke</span>yword =&gt; <span class="cstat-no" title="statement not covered" >lowerMessage.includes(keyword))</span>;</span>
  
<span class="cstat-no" title="statement not covered" >  return hasSearchKeyword &amp;&amp; hasCarTerm &amp;&amp; !isInventoryQuery;</span>
};
&nbsp;
// Function to perform web search
const performWebSearch = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >as</span>ync (query) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >  try {</span>
<span class="cstat-no" title="statement not covered" >    if (!process.env.GOOGLE_SEARCH_API_KEY || !process.env.GOOGLE_SEARCH_ENGINE_ID) {</span>
<span class="cstat-no" title="statement not covered" >      console.log('Google Search API not configured, skipping web search');</span>
<span class="cstat-no" title="statement not covered" >      return null;</span>
    }
&nbsp;
    const searchQuery = <span class="cstat-no" title="statement not covered" >`cars ${query}`;</span>
    const url = <span class="cstat-no" title="statement not covered" >`https://www.googleapis.com/customsearch/v1?key=${process.env.GOOGLE_SEARCH_API_KEY}&amp;cx=${process.env.GOOGLE_SEARCH_ENGINE_ID}&amp;q=${encodeURIComponent(searchQuery)}&amp;num=5`;</span>
&nbsp;
    const response = <span class="cstat-no" title="statement not covered" >await fetch(url);</span>
<span class="cstat-no" title="statement not covered" >    if (!response.ok) {</span>
<span class="cstat-no" title="statement not covered" >      throw new Error(`Search API error: ${response.status}`);</span>
    }
&nbsp;
    const data = <span class="cstat-no" title="statement not covered" >await response.json();</span>
    
<span class="cstat-no" title="statement not covered" >    if (data.items &amp;&amp; data.items.length &gt; 0) {</span>
      const searchResults = <span class="cstat-no" title="statement not covered" >data.items.map(<span class="fstat-no" title="function not covered" >it</span>em =&gt; (<span class="cstat-no" title="statement not covered" >{</span></span>
        title: item.title,
        snippet: item.snippet,
        link: item.link
      }));
      
<span class="cstat-no" title="statement not covered" >      return searchResults;</span>
    }
    
<span class="cstat-no" title="statement not covered" >    return null;</span>
  } catch (error) {
<span class="cstat-no" title="statement not covered" >    console.error('Web search error:', error);</span>
<span class="cstat-no" title="statement not covered" >    return null;</span>
  }
};
&nbsp;
// System prompt for the chatbot
const getSystemPrompt = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(l</span>anguage, availableCars, searchResults = <span class="branch-0 cbranch-no" title="branch not covered" >null)</span> =&gt; {</span>
  const carsInfo = <span class="cstat-no" title="statement not covered" >availableCars.map(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; </span>
<span class="cstat-no" title="statement not covered" >    `- ${car.brand} ${car.model} (${car.year}): $${car.price}, ${car.category}, ${car.transmission}, ${car.fuelType}, ${car.seats} seats, ${car.color}`</span>
  ).join('\n');
&nbsp;
  let webSearchInfo = <span class="cstat-no" title="statement not covered" >'';</span>
<span class="cstat-no" title="statement not covered" >  if (searchResults) {</span>
<span class="cstat-no" title="statement not covered" >    webSearchInfo = '\n\nWeb Search Results (use this information to answer general car questions):\n' + </span>
      searchResults.map(<span class="fstat-no" title="function not covered" >re</span>sult =&gt; 
<span class="cstat-no" title="statement not covered" >        `Title: ${result.title}\nSummary: ${result.snippet}\nSource: ${result.link}`</span>
      ).join('\n\n');
  }
&nbsp;
  const prompts = <span class="cstat-no" title="statement not covered" >{</span>
    english: `You are a helpful car sales assistant for an online car dealership. Your role is to:
1. Help customers find the perfect car based on their needs and budget
2. Provide detailed information about specific cars
3. Make personalized recommendations
4. Answer questions about features, pricing, and specifications
5. Answer general car-related questions using web search results when available
&nbsp;
Available cars in our inventory:
${carsInfo}${webSearchInfo}
&nbsp;
Guidelines:
- Always be helpful and enthusiastic
- If a customer asks about a car not in inventory, politely inform them and suggest alternatives
- When recommending cars, consider budget, family size, fuel efficiency, and usage
- Keep responses concise but informative
- If asked about financing or delivery, inform them to contact sales for details
- For general car questions (reviews, specs, news, etc.), use the web search results provided above to give accurate information
- If web search results are available, mention that you're using current web information`,
&nbsp;
    arabic: `أنت مساعد مبيعات سيارات مفيد لوكالة سيارات عبر الإنترنت. دورك هو:
1. مساعدة العملاء في العثور على السيارة المثالية بناءً على احتياجاتهم وميزانيتهم
2. تقديم معلومات مفصلة عن سيارات محددة
3. تقديم توصيات شخصية
4. الإجابة على الأسئلة حول الميزات والأسعار والمواصفات
5. الإجابة على الأسئلة العامة المتعلقة بالسيارات باستخدام نتائج البحث على الويب عند توفرها
&nbsp;
السيارات المتوفرة في مخزوننا:
${carsInfo}${webSearchInfo}
&nbsp;
الإرشادات:
- كن دائمًا مفيدًا ومتحمسًا
- إذا سأل العميل عن سيارة غير موجودة في المخزون، أخبره بأدب واقترح بدائل
- عند التوصية بالسيارات، ضع في الاعتبار الميزانية وحجم العائلة وكفاءة الوقود والاستخدام
- اجعل الردود موجزة ولكن غنية بالمعلومات
- إذا سُئل عن التمويل أو التسليم، أخبرهم بالاتصال بقسم المبيعات للحصول على التفاصيل
- للأسئلة العامة عن السيارات (مراجعات، مواصفات، أخبار، إلخ)، استخدم نتائج البحث على الويب المقدمة أعلاه لتقديم معلومات دقيقة
- إذا كانت نتائج البحث على الويب متاحة، اذكر أنك تستخدم معلومات الويب الحالية`
  };
&nbsp;
<span class="cstat-no" title="statement not covered" >  return prompts[language] || prompts.english;</span>
};
&nbsp;
// Chat with the bot
const chatWithBot = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >as</span>ync (req, res) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >  try {</span>
    const { message, language = <span class="branch-0 cbranch-no" title="branch not covered" >'english',</span> conversationHistory = <span class="branch-0 cbranch-no" title="branch not covered" >[] </span>} = <span class="cstat-no" title="statement not covered" >req.body;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (!message) {</span>
<span class="cstat-no" title="statement not covered" >      return res.status(400).json({ error: 'Message is required' });</span>
    }
&nbsp;
    // Validate language
    const validLanguages = <span class="cstat-no" title="statement not covered" >['english', 'arabic'];</span>
    const selectedLanguage = <span class="cstat-no" title="statement not covered" >validLanguages.includes(language) ? language : 'english';</span>
&nbsp;
    // Fetch available cars from database or static data
    const availableCars = <span class="cstat-no" title="statement not covered" >await getAvailableCarsData();</span>
&nbsp;
    // Check if web search is needed
    const requiresWebSearch = <span class="cstat-no" title="statement not covered" >needsWebSearch(message);</span>
    let searchResults = <span class="cstat-no" title="statement not covered" >null;</span>
    let isWebSearch = <span class="cstat-no" title="statement not covered" >false;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (requiresWebSearch) {</span>
<span class="cstat-no" title="statement not covered" >      searchResults = await performWebSearch(message);</span>
<span class="cstat-no" title="statement not covered" >      if (searchResults) {</span>
<span class="cstat-no" title="statement not covered" >        isWebSearch = true;</span>
      }
    }
&nbsp;
    // Build conversation history for Claude
    const messages = <span class="cstat-no" title="statement not covered" >[</span>
      ...conversationHistory.map(<span class="fstat-no" title="function not covered" >ms</span>g =&gt; (<span class="cstat-no" title="statement not covered" >{</span>
        role: msg.role,
        content: msg.content
      })),
      {
        role: 'user',
        content: message
      }
    ];
&nbsp;
    // Call Claude API
    let botResponse;
<span class="cstat-no" title="statement not covered" >    if (process.env.CLAUDE_API_KEY) {</span>
      const response = <span class="cstat-no" title="statement not covered" >await fetch('https://api.anthropic.com/v1/messages', {</span>
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': process.env.CLAUDE_API_KEY,
          'anthropic-version': '2023-06-01'
        },
        body: JSON.stringify({
          model: 'claude-3-5-sonnet-20241022',
          max_tokens: 1024,
          system: getSystemPrompt(selectedLanguage, availableCars, searchResults),
          messages: messages
        })
      });
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (!response.ok) {</span>
<span class="cstat-no" title="statement not covered" >        throw new Error(`Claude API error: ${response.statusText}`);</span>
      }
&nbsp;
      const data = <span class="cstat-no" title="statement not covered" >await response.json();</span>
<span class="cstat-no" title="statement not covered" >      botResponse = data.content[0].text;</span>
    } else {
      // Fallback response when API key is not set
      const lowerMessage = <span class="cstat-no" title="statement not covered" >message.toLowerCase();</span>
      let response = <span class="cstat-no" title="statement not covered" >'';</span>
      
<span class="cstat-no" title="statement not covered" >      if (lowerMessage.includes('available') &amp;&amp; lowerMessage.includes('car')) {</span>
<span class="cstat-no" title="statement not covered" >        if (availableCars.length &gt; 0) {</span>
          const carsList = <span class="cstat-no" title="statement not covered" >availableCars.slice(0, 5).map(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; <span class="cstat-no" title="statement not covered" >`${car.brand} ${car.model} (${car.year}) - $${car.price}`)</span>.join(', ');</span>
<span class="cstat-no" title="statement not covered" >          response = selectedLanguage === 'english'</span>
            ? `We currently have these cars available: ${carsList}. Which one interests you?`
            : `لدينا هذه السيارات المتوفرة حالياً: ${carsList}. أي منها يثير اهتمامك؟`;
        } else {
<span class="cstat-no" title="statement not covered" >          response = selectedLanguage === 'english'</span>
            ? "I'm sorry, we don't have any cars available right now. Please check back later!"
            : "عذراً، ليس لدينا أي سيارات متوفرة الآن. يرجى المحاولة لاحقاً!";
        }
      } else <span class="cstat-no" title="statement not covered" >if (lowerMessage.includes('suv') || lowerMessage.includes('family') || lowerMessage.includes('عائلي')) {</span>
        const suvs = <span class="cstat-no" title="statement not covered" >availableCars.filter(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; <span class="cstat-no" title="statement not covered" >car.category === 'SUV')</span>.slice(0, 3);</span>
<span class="cstat-no" title="statement not covered" >        if (suvs.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >          response = selectedLanguage === 'english'</span>
            ? `For family adventures, I recommend these SUVs: ${suvs.map(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; <span class="cstat-no" title="statement not covered" >`${car.brand} ${car.model} for $${car.price}`)</span>.join(', ')}. They're perfect for road trips with the kids!`
            : `للمغامرات العائلية، أوصي بهذه السيارات SUV: ${suvs.map(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; <span class="cstat-no" title="statement not covered" >`${car.brand} ${car.model} بسعر $${car.price}`)</span>.join(', ')}. مثالية للرحلات مع الأطفال!`;
        } else {
<span class="cstat-no" title="statement not covered" >          response = selectedLanguage === 'english'</span>
            ? "I don't have any SUVs available right now, but I can suggest some spacious alternatives for your family!"
            : "ليس لدي أي سيارات SUV متوفرة الآن، لكن يمكنني اقتراح بعض البدائل الواسعة لعائلتك!";
        }
      } else <span class="cstat-no" title="statement not covered" >if (lowerMessage.includes('sedan') || lowerMessage.includes('economy') || lowerMessage.includes('اقتصادي')) {</span>
        const sedans = <span class="cstat-no" title="statement not covered" >availableCars.filter(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; <span class="cstat-no" title="statement not covered" >car.category === 'Sedan')</span>.slice(0, 3);</span>
<span class="cstat-no" title="statement not covered" >        if (sedans.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >          response = selectedLanguage === 'english'</span>
            ? `If you're looking for fuel efficiency, these sedans are great: ${sedans.map(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; <span class="cstat-no" title="statement not covered" >`${car.brand} ${car.model} for $${car.price}`)</span>.join(', ')}. Very economical to run!`
            : `إذا كنت تبحث عن كفاءة الوقود، هذه السيارات رائعة: ${sedans.map(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; <span class="cstat-no" title="statement not covered" >`${car.brand} ${car.model} بسعر $${car.price}`)</span>.join(', ')}. اقتصادية جداً في التشغيل!`;
        } else {
<span class="cstat-no" title="statement not covered" >          response = selectedLanguage === 'english'</span>
            ? "Let me show you our sedan options - they're perfect for daily commuting!"
            : "دعني أريك خياراتنا من السيارات - مثالية للتنقل اليومي!";
        }
      } else <span class="cstat-no" title="statement not covered" >if (lowerMessage.includes('luxury') || lowerMessage.includes('expensive') || lowerMessage.includes('فاخر')) {</span>
        const luxury = <span class="cstat-no" title="statement not covered" >availableCars.filter(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; <span class="cstat-no" title="statement not covered" >car.price &gt; 50000)</span>.slice(0, 3);</span>
<span class="cstat-no" title="statement not covered" >        if (luxury.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >          response = selectedLanguage === 'english'</span>
            ? `For that premium feel, check out these luxury options: ${luxury.map(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; <span class="cstat-no" title="statement not covered" >`${car.brand} ${car.model} for $${car.price}`)</span>.join(', ')}. Pure sophistication!`
            : `للشعور الفاخر، تحقق من هذه الخيارات: ${luxury.map(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; <span class="cstat-no" title="statement not covered" >`${car.brand} ${car.model} بسعر $${car.price}`)</span>.join(', ')}. أناقة نقية!`;
        } else {
<span class="cstat-no" title="statement not covered" >          response = selectedLanguage === 'english'</span>
            ? "We have some high-end vehicles that might suit your taste for luxury!"
            : "لدينا بعض المركبات عالية الجودة التي قد تناسب ذوقك للفخامة!";
        }
      } else <span class="cstat-no" title="statement not covered" >if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('مرحبا')) {</span>
<span class="cstat-no" title="statement not covered" >        response = selectedLanguage === 'english'</span>
          ? "Hello there! I'm excited to help you find your perfect car. What are you in the market for today?"
          : "مرحباً! أنا متحمس لمساعدتك في العثور على سيارتك المثالية. ما الذي تبحث عنه اليوم؟";
      } else <span class="cstat-no" title="statement not covered" >if (lowerMessage.includes('price') || lowerMessage.includes('cost') || lowerMessage.includes('سعر')) {</span>
        const affordable = <span class="cstat-no" title="statement not covered" >availableCars.filter(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; <span class="cstat-no" title="statement not covered" >car.price &lt; 30000)</span>.slice(0, 3);</span>
<span class="cstat-no" title="statement not covered" >        if (affordable.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >          response = selectedLanguage === 'english'</span>
            ? `We have some great deals under $30,000: ${affordable.map(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; <span class="cstat-no" title="statement not covered" >`${car.brand} ${car.model} for $${car.price}`)</span>.join(', ')}. Budget-friendly options!`
            : `لدينا بعض العروض الرائعة تحت 30,000 دولار: ${affordable.map(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; <span class="cstat-no" title="statement not covered" >`${car.brand} ${car.model} بسعر $${car.price}`)</span>.join(', ')}. خيارات مناسبة للميزانية!`;
        } else {
<span class="cstat-no" title="statement not covered" >          response = selectedLanguage === 'english'</span>
            ? "Tell me your budget and I'll find cars that fit perfectly!"
            : "أخبرني بميزانيتك وسأجد سيارات تناسب تماماً!";
        }
      } else <span class="cstat-no" title="statement not covered" >if (lowerMessage.includes('new') || lowerMessage.includes('used') || lowerMessage.includes('جديد') || lowerMessage.includes('مستعمل')) {</span>
<span class="cstat-no" title="statement not covered" >        response = selectedLanguage === 'english'</span>
          ? "We have both new and used cars available. What type of vehicle are you interested in? New cars come with full warranty, while our certified used cars are thoroughly inspected!"
          : "لدينا سيارات جديدة ومستعملة متاحة. ما نوع السيارة التي تهتم بها؟ السيارات الجديدة تأتي مع ضمان كامل، بينما سياراتنا المستعملة المعتمدة تم فحصها بدقة!";
      } else {
        // General conversational responses
        const generalResponses = <span class="cstat-no" title="statement not covered" >selectedLanguage === 'english' ? [</span>
          "That's interesting! While I'm primarily here to help with cars, I'd be happy to chat about automotive topics. What kind of vehicle are you thinking about?",
          "I love talking about cars! Whether it's performance, comfort, or reliability, I can help you find the right one. What's on your mind?",
          "Great question! I'm your car expert. Let me know what you're looking for - from compact cars to luxury SUVs, I've got recommendations!",
          "I'm here to make your car buying experience amazing! Tell me more about what you need, and I'll guide you to the perfect vehicle."
        ] : [
          "هذا مثير للاهتمام! بينما أنا هنا بشكل أساسي للمساعدة في السيارات، سأكون سعيداً للحديث عن مواضيع السيارات. ما نوع السيارة التي تفكر فيها؟",
          "أحب الحديث عن السيارات! سواء كان الأداء أو الراحة أو الموثوقية، يمكنني مساعدتك في العثور على المناسب. ما الذي يدور في ذهنك؟",
          "سؤال رائع! أنا خبير السيارات الخاص بك. أخبرني بما تحتاجه، وسأرشدك إلى السيارة المثالية.",
          "أنا هنا لجعل تجربة شراء سيارتك رائعة! أخبرني المزيد عما تحتاجه، وسأرشدك إلى السيارة المثالية."
        ];
<span class="cstat-no" title="statement not covered" >        response = generalResponses[Math.floor(Math.random() * generalResponses.length)];</span>
      }
      
<span class="cstat-no" title="statement not covered" >      botResponse = response;</span>
    }
&nbsp;
    // Extract car recommendations if any are mentioned
    const recommendedCars = <span class="cstat-no" title="statement not covered" >availableCars.filter(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; {</span>
      const carIdentifier = <span class="cstat-no" title="statement not covered" >`${car.brand} ${car.model}`.toLowerCase();</span>
<span class="cstat-no" title="statement not covered" >      return botResponse.toLowerCase().includes(carIdentifier);</span>
    }).slice(0, 3);
&nbsp;
<span class="cstat-no" title="statement not covered" >    res.status(200).json({</span>
      message: botResponse,
      recommendedCars: recommendedCars.map(<span class="fstat-no" title="function not covered" >ca</span>r =&gt; (<span class="cstat-no" title="statement not covered" >{</span>
        _id: car._id,
        brand: car.brand,
        model: car.model,
        year: car.year,
        price: car.price,
        image: car.images?.[0] || ''
      })),
      language: selectedLanguage,
      isWebSearch: isWebSearch
    });
&nbsp;
  } catch (error) {
<span class="cstat-no" title="statement not covered" >    console.error('Chatbot error:', error);</span>
<span class="cstat-no" title="statement not covered" >    res.status(500).json({ </span>
      error: 'Failed to process chat message',
      details: error.message 
    });
  }
};
&nbsp;
// Get available cars for chatbot context
const getAvailableCars = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >as</span>ync (req, res) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >  try {</span>
    const cars = <span class="cstat-no" title="statement not covered" >await getAvailableCarsData();</span>
<span class="cstat-no" title="statement not covered" >    res.status(200).json({ cars });</span>
  } catch (error) {
<span class="cstat-no" title="statement not covered" >    console.error('Error fetching cars:', error);</span>
<span class="cstat-no" title="statement not covered" >    res.status(500).json({ error: 'Failed to fetch cars' });</span>
  }
};
&nbsp;
<span class="cstat-no" title="statement not covered" >module.exports = {</span>
  chatWithBot,
  getAvailableCars,
  getAvailableCarsData,
  needsWebSearch,
  performWebSearch
};</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-12-20T04:07:02.958Z
            </div>
        <script src="../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../sorter.js"></script>
        <script src="../block-navigation.js"></script>
    </body>
</html>
    